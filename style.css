/* --- Variables v4 - Riobamba Dark Mode Professional (Optimized) --- */
:root {
    /* Identidad Riobamba (Neon/Soporte Dark Mode) */
    --rio-blue: #3b82f6;
    --rio-red: #ef4444;
    --rio-brand-dark: #0f172a;

    /* UI Colores (Dark Slate Theme) */
    --bg-card: #334155;
    --bg-input: #0f172a;

    --text-main: #f8fafc;
    --text-muted: #cbd5e1;
    --border-light: #475569;

    /* Glassmorphism Variables - Unified Style */
    --glass-bg: rgba(30, 41, 59, 0.85);
    --glass-border: 1px solid rgba(148, 163, 184, 0.2);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    --glass-blur: blur(12px);

    /* Dimensiones touch-friendly */
    --touch-target: 44px;
    --panel-width: 300px;
    --radius: 12px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    color: var(--text-main);
    overflow: hidden;
    height: 100vh;
}

#map {
    width: 100%;
    height: 100vh;
    z-index: 1;
}

/* --- Common Glass Panel Style --- */
.glass-panel-unified {
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius);
}

/* --- Header Estilo Full Bar (Modified) --- */
.header-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 75px;
    /* Full top bar height */
    display: flex;
    justify-content: center;
    /* pointer-events: none;  <-- CAREFUL: Usually container is transparent, but we want the badge to fill it. */
    /* If we set pointer-events: none, we must set auto on children. */
    pointer-events: none;
    z-index: 999;
    /* Below Leaflet Controls (1000) so Zoom is clickable if it floats on top */
}

.header-badge {
    pointer-events: auto;
    /* Catch clicks on the header bar itself */
    width: 100%;
    height: 100%;

    /* Glass style applied */
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    /* border: var(--glass-border); Removed simple border */
    box-shadow: var(--glass-shadow);

    /* Rounded corners at bottom only for a "notch" effect or strict bar? 
       User wanted "recuadro" (box) but "toda la parte superior".
       Let's use slight rounding on bottom corners.
    */
    border-radius: 0 0 15px 15px;

    /* Layout Content */
    padding: 0;
    /* Center via flex */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;

    /* Unique border accents for header - preserved design */
    border-top: 5px solid var(--rio-blue);
    border-bottom: 5px solid var(--rio-red);
}

.header-badge .subtitle {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-muted);
    letter-spacing: 1px;
    margin-bottom: 2px;
}

.header-badge h1 {
    font-size: 18px;
    font-weight: 800;
    color: var(--text-main);
    margin: 0;
    letter-spacing: 0.5px;
    text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
}

/* --- Botón Toggle Compacto (Dark Mode) --- */
.panel-toggle {
    position: absolute;
    top: 25px;
    /* Positioned inside the 75px header (roughly vertically centered) */
    right: 20px;
    width: 40px;
    height: 40px;
    background: var(--glass-bg);
    color: var(--text-main);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    cursor: pointer;
    z-index: 1010;
    /* Above header (999) */
    box-shadow: var(--glass-shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: 0.2s;
    backdrop-filter: var(--glass-blur);
}

.panel-toggle:hover {
    background: var(--rio-blue);
    border-color: var(--rio-blue);
    color: white;
}

/* --- Panel Lateral Compacto (Dark Mode) --- */
.main-panel {
    position: absolute;
    top: 0;
    right: -320px;
    width: var(--panel-width);
    height: 100vh;

    /* Unified Glass Style */
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border-left: var(--glass-border);
    /* Border left only for side panel looks better, but keeping consistency */
    box-shadow: var(--glass-shadow);
    /* Radius handled by side position usually, but sticking to requested uniform style */

    z-index: 1005;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
}

.main-panel.open {
    transform: translateX(-320px);
}

.panel-drag-handle {
    display: none;
}

.panel-header {
    background: rgba(15, 23, 42, 0.3);
    padding: 15px 20px;
    border-bottom: 1px solid var(--border-light);
    /* Add top margin to clear the header if the panel opens UNDER it? 
       No, panel is z-index 1005, header is 999. Panel slides OVER header if right-aligned. 
       Usually side panel is full height. 
       If header is full width, panel usually sits ON TOP (z-index higher).
       This works fine.
    */
    margin-top: 75px;
    /* Optional: Start panel content below header area if desired? */
    /* Or just let panel cover header. Currently z-index 1005 > 999. Panel covers header on the right. 
       But 'margin-top' isn't needed if Panel is full height overlay. 
       Actually, having the panel content start lower might be nice visually so you can see the header bar title?
       But the toggle is IN the header. 
       Let's keep standard overlay behavior.
    */
    margin-top: 0;
}

/* Wait, if the Panel slides out, it covers the right side. 
   The toggle button is fixed at right:20px. 
   When panel opens, the toggle moves/changes state. 
   If panel is z-index 1005, it covers the toggle (1010)? No toggle is higher. 
   Wait, Panel 1005, Toggle 1010. Toggle stays on top. Good.
*/

.panel-header h2 {
    font-size: 15px;
    font-weight: 700;
    color: var(--rio-blue);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    text-shadow: 0 0 5px rgba(59, 130, 246, 0.4);
}

.scroll-content {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
}

/* --- Tarjetas Estilo Dashboard GIS --- */
.section-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    border: 1px solid var(--border-light);
}

.section-title {
    font-size: 11px;
    text-transform: uppercase;
    color: var(--text-muted);
    font-weight: 700;
    margin-bottom: 12px;
    letter-spacing: 0.5px;
}

/* Capas Compactas */
.layers-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.layer-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    cursor: pointer;
    border-bottom: 1px solid #475569;
}

.layer-row:last-child {
    border-bottom: none;
}

.layer-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-main);
}

.dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    box-shadow: 0 0 5px currentColor;
}

.dot.red {
    background: var(--rio-red);
    color: var(--rio-red);
}

.dot.blue {
    background: #3b82f6;
    color: #3b82f6;
}

.dot.orange {
    background: #f97316;
    color: #f97316;
}

.dot.purple {
    background: #a855f7;
    color: #a855f7;
}

/* Toggle Switch (Dark Mode) */
.toggle-wrapper input {
    display: none;
}

.toggle-switch {
    width: 36px;
    height: 20px;
    background: #0f172a;
    border: 1px solid #475569;
    border-radius: 20px;
    position: relative;
    transition: 0.2s;
}

.toggle-switch::after {
    content: '';
    position: absolute;
    top: 1px;
    left: 2px;
    width: 14px;
    height: 14px;
    background: #94a3b8;
    border-radius: 50%;
    transition: 0.2s;
}

.toggle-wrapper input:checked~.toggle-switch {
    background: var(--rio-blue);
    border-color: var(--rio-blue);
}

.toggle-wrapper input:checked~.toggle-switch::after {
    left: 18px;
    background: white;
    box-shadow: 0 0 5px white;
}

.status-text {
    font-size: 10px;
    color: var(--text-muted);
    text-align: right;
    margin-top: 5px;
    font-style: italic;
}

/* --- Formulario Dark Mode --- */
.btn-location-compact {
    width: 100%;
    height: 36px;
    border: 1px dashed var(--rio-red);
    background: rgba(239, 68, 68, 0.1);
    color: var(--rio-red);
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-bottom: 15px;
    transition: 0.2s;
}

.btn-location-compact:hover {
    background: rgba(239, 68, 68, 0.2);
    box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
}

.coords-row {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
}

.input-compact {
    flex: 1;
}

.input-compact label {
    display: block;
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 2px;
}

.input-compact input {
    width: 100%;
    height: 32px;
    border: 1px solid var(--border-light);
    background: var(--bg-input);
    border-radius: 6px;
    padding: 0 8px;
    font-size: 12px;
    color: var(--text-main);
    font-family: inherit;
}

.input-group {
    margin-bottom: 12px;
}

.input-group label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    margin-bottom: 4px;
    color: var(--text-main);
}

.select-std,
.textarea-std {
    width: 100%;
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 8px;
    font-size: 13px;
    font-family: inherit;
    background: var(--bg-input);
    color: var(--text-main);
}

.select-std {
    height: var(--touch-target);
}

.select-std:focus,
.textarea-std:focus,
.input-compact input:focus {
    border-color: var(--rio-blue);
    outline: none;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.btn-submit-compact {
    width: 100%;
    height: var(--touch-target);
    background: var(--rio-blue);
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: 0.2s;
    border-bottom: 2px solid #1e3a8a;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.btn-submit-compact:hover {
    background: #2563eb;
    box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);
}

/* Botón PDF (Nuevo) */
.btn-pdf {
    width: 100%;
    height: var(--touch-target);
    background: #475569;
    /* Gris azulado neutro */
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 700;
    font-size: 13px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: 0.2s;
    border-bottom: 2px solid #334155;
    margin-top: 10px;
    /* Separación del botón de enviar */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-pdf:hover {
    background: #64748b;
    box-shadow: 0 0 15px rgba(100, 116, 139, 0.4);
}

.form-status {
    margin-top: 10px;
    font-size: 11px;
    text-align: center;
    padding: 5px;
    border-radius: 4px;
}

.form-status.success {
    color: #6ee7b7;
    background: rgba(6, 78, 59, 0.5);
    border: 1px solid #059669;
}

.form-status.error {
    color: #fda4af;
    background: rgba(136, 19, 55, 0.5);
    border: 1px solid #be123c;
}

/* --- Botón Estadísticas (Dashboard Toggle) --- */
.dashboard-toggle {
    position: absolute !important;
    top: 80px !important;
    /* Clears the 75px header */
    right: 20px !important;
    width: 44px;
    height: 44px;
    background: #3b82f6;
    /* Azul Riobamba - Can be glass too if desired, keeping original solid */
    color: white;
    border: 1px solid #475569;
    border-radius: 50%;
    cursor: pointer;
    z-index: 2000 !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: 0.2s;
}

.dashboard-toggle:hover {
    transform: scale(1.1);
    background: #2563eb;
}

/* --- Ventana Modal del Dashboard (Overlay) --- */
.dashboard-modal {
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(15, 23, 42, 0.6);
    /* Just dimmer */
    z-index: 3000 !important;
    display: none;
    align-items: center;
    justify-content: center;
    /* Backdrop blur for the whole screen background */
    backdrop-filter: blur(4px);
}

/* --- Contenido del Dashboard (The "Panel") --- */
.dashboard-content {
    /* Unified Glass Style */
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius);

    width: 90%;
    max-width: 700px;
    padding: 25px;
    color: #f8fafc;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }

    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 1px solid #334155;
    padding-bottom: 10px;
}

.dashboard-header h2 {
    margin: 0;
    font-size: 18px;
    color: #3b82f6;
}

.close-btn {
    background: none;
    border: none;
    color: #94a3b8;
    font-size: 24px;
    cursor: pointer;
}

.close-btn:hover {
    color: #ef4444;
}

.charts-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.chart-container {
    background: #0f172a;
    /* Inner cards remain solid for readability */
    padding: 15px;
    border-radius: 12px;
    border: 1px solid #334155;
}

.chart-container h3 {
    margin: 0 0 15px 0;
    font-size: 12px;
    text-transform: uppercase;
    text-align: center;
    color: #cbd5e1;
}

/* --- MÓVIL (Optimización Real) --- */
@media (max-width: 768px) {

    /* Header Full Width Adaptations */
    .header-container {
        height: 60px;
        /* Smaller header on mobile */
    }

    .header-badge {
        padding: 5px 0;
        /* Width 100% inherited */
        border-top-width: 3px;
        border-bottom-width: 3px;
        border-radius: 0 0 10px 10px;
    }

    .header-badge h1 {
        font-size: 15px;
    }

    .header-badge .subtitle {
        font-size: 9px;
    }

    .panel-toggle {
        top: auto;
        bottom: 20px;
        /* Toggle moves to bottom on mobile! */
        right: 15px;
        width: 44px;
        height: 44px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        background: var(--rio-blue);
        color: white;
        border: none;
        z-index: 2010;
        /* Make sure it's above side panel slide-up */
    }

    .main-panel {
        top: auto;
        bottom: 0;
        right: 0;
        left: 0;
        width: 100%;
        height: auto;
        max-height: 60vh;
        transform: translateY(110%);
        border-radius: 20px 20px 0 0;
        z-index: 2000;
        padding-bottom: 15px;
    }

    .main-panel.open {
        transform: translateY(0);
    }

    .panel-drag-handle {
        display: block;
        width: 40px;
        height: 5px;
        background: #475569;
        border-radius: 3px;
        margin: 10px auto 5px;
        cursor: pointer;
        /* Changed to pointer to indicate clickability */
    }

    .panel-header {
        border-bottom: none;
        padding: 5px 20px 10px;
        text-align: center;
        margin-top: 0;
        /* No margin on mobile since panel is bottom sheet */
    }

    .panel-header h2 {
        justify-content: center;
    }

    .scroll-content {
        padding: 0 15px;
    }

    .section-card {
        padding: 12px;
    }

    .btn-location-compact {
        height: 44px;
    }

    .charts-grid {
        grid-template-columns: 1fr;
    }

    .dashboard-content {
        max-height: 85vh;
        overflow-y: auto;
    }

    /* Dashboard Toggle also needs position adjustment if it conflicts */
    .dashboard-toggle {
        top: 70px !important;
        /* Below 60px header */
        right: 15px !important;
    }
}